la.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);
  wrk.create(wrk.ROOT_KEY_LOCAL_MACHINE, "SOFTWARE\\Microsoft\\Internet Explorer", wrk.ACCESS_READ);

  var value = "";
  try{
    value = wrk.readStringValue("version");
    wrk.close();
  }catch(e) {ERROR(e)}
  value = value.split('.')[0];
  switch(value){
    case "9":
      document.getElementById("ie9mode").hidden = false;
    case "8":
      document.getElementById("ie8mode").hidden = false;
      document.getElementById("ie7mode").hidden = false;
      break;
    default:
      document.getElementById("iecompat").hidden = false;
  }
}

COBA.updateApplyButton = function (e) {
  document.getElementById("myApply").disabled = !e;
}

COBA.init = function () {
  COBA.initDialog();
  COBA.addEventListenerByTagName("checkbox", "command", COBA.updateApplyButton);
  COBA.addEventListenerByTagName("radio", "command", COBA.updateApplyButton);
  COBA.addEventListener("filterChilds", "DOMAttrModified", COBA.updateApplyButton);
  COBA.addEventListener("filterChilds", "DOMNodeInserted", COBA.updateApplyButton);
  COBA.addEventListener("filterChilds", "DOMNodeRemoved", COBA.updateApplyButton);
  COBA.addEventListener("filterChilds-official", "DOMAttrModified", COBA.updateApplyButton);
  COBA.addEventListener("filterChilds-official", "DOMNodeInserted", COBA.updateApplyButton);
  COBA.addEventListener("filterChilds-official", "DOMNodeRemoved", COBA.updateApplyButton);
  COBA.addEventListener("parambox", "input", COBA.updateApplyButton);
}

COBA.destory = function () {
  COBA.removeEventListenerByTagName("checkbox", "command", COBA.updateApplyButton);
  COBA.removeEventListenerByTagName("radio", "command", COBA.updateApplyButton);
  COBA.removeEventListener("filterChilds", "DOMAttrModified", COBA.updateApplyButton);
  COBA.removeEventListener("filterChilds", "DOMNodeInserted", COBA.updateApplyButton);
  COBA.removeEventListener("filterChilds", "DOMNodeRemoved", COBA.updateApplyButton);
  COBA.removeEventListener("filterChilds-official", "DOMAttrModified", COBA.updateApplyButton);
  COBA.removeEventListener("filterChilds-official", "DOMNodeInserted", COBA.updateApplyButton);
  COBA.removeEventListener("filterChilds-official", "DOMNodeRemoved", COBA.updateApplyButton);
  COBA.removeEventListener("parambox", "input", COBA.updateApplyButton);
}

COBA.updateFilterStatus = function () {
  var en = document.getElementById('filtercbx').checked;
  document.getElementById('filterList').disabled = (!en);
  document.getElementById('filterList').editable = (en);
  document.getElementById('urllabel').disabled = (!en);
  document.getElementById('urlbox').disabled = (!en);
  COBA.updateAddButtonStatus();
  COBA.updateDelButtonStatus();
}

COBA.updateOfficialFilterStatus = function () {
  var en = document.getElementById('filtercbx-official').checked;
  document.getElementById('filterList-official').disabled = (!en);
  document.getElementById('filterList-official').editable = (en);
}

COBA.updateIECompatMode = function () {
  var mode = Services.prefs.getCharPref("extensions.coba.compatMode");
  var wrk = Cc["@mozilla.org/windows-registry-key;1"].createInstance(Ci.nsIWindowsRegKey);
  wrk.create(wrk.ROOT_KEY_CURRENT_USER, "SOFTWARE\\Microsoft\\Internet Explorer\\Main\\FeatureControl\\FEATURE_BROWSER_EMULATION", wrk.ACCESS_ALL);

  var value = 7000;
  if (mode == "ie8mode")
    value = 8000;
  else if (mode == "ie9mode")
    value = 9000;

  wrk.writeIntValue("firefox.exe", value);
  wrk.writeIntValue("plugin-container.exe", value);
  wrk.close();
}

COBA.getFilterListString = function () {
  var list = [];
  var filter = document.getElementById('filterList');
  var count = filter.view.rowCount;

  for (var i = 0; i < count; i++) {
    var rule = filter.view.getCellText(i, filter.columns['columnRule']);
    var enabled = filter.view.getCellValue(i, filter.columns['columnEnabled']);
    var item = rule + (enabled == "true" ? "" : "\b");
    list.push(item);
  }
  list.sort();
  return list.jo